# コーディングプラクティス

## 原則

### オニオンアーキテクチャ
- 値オブジェクトとエンティティを区別
- 集約で整合性を保証
- リポジトリでデータアクセスを抽象化
- 境界付けられたコンテキストを意識

層の呼び方は次のとおり。

- プレゼンテーション層: presentation
- インフラ層: infrastructure
- ユースケース層: usecase
- ドメイン層: domain

それぞれの層で呼び出せる層は次のとおりです。
- presentation: 全部
- infrastructure: usecaseかdomainで定義したインターフェース
- usecase: domainのみ
- domain: 無し

### 値オブジェクト

- 不変
- 値に基づく同一性
- 自己検証
- ドメイン操作を持つ

### エンティティ

- IDに基づく同一性
- 制御された更新
- 整合性ルールを持つ


### リポジトリ

- ドメインモデルのみを扱う
- 永続化の詳細を隠蔽
- テスト用のインメモリ実装を提供


### テスト駆動開発 (TDD)
- Red-Green-Refactorサイクル
- テストを仕様として扱う
- 小さな単位で反復
- 継続的なリファクタリング

## 実装手順

1. 型設計
   - まず型を定義
   - ドメインの言語を型で表現

2. 純粋関数から実装
   - 外部依存のない関数を先に
   - テストを先に書く

3. 副作用を分離
   - IO操作は関数の境界に押し出す
   - 副作用を持つ処理をPromiseでラップ

4. その他実装
   - 外部サービスやDBへのアクセスを抽象化
   - テスト用モックを用意

## プラクティス

- 小さく始めて段階的に拡張
- 過度な抽象化を避ける
- コードよりも型を重視
- 複雑さに応じてアプローチを調整

## コードスタイル

- 早期リターンで条件分岐をフラット化
- エラーとユースケースの列挙型定義

## テスト戦略

- 純粋関数の単体テストを優先
- インメモリ実装によるリポジトリテスト
- テスト可能性を設計に組み込む
- アサートファースト：期待結果から逆算
